<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MONITORING GFORM</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* ===== CSS ===== */
body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; color:#222; }
header { background:#1e5bb8; color:white; padding:15px; text-align:center; font-size:20px; font-weight:bold; position:fixed; top:0; left:0; right:0; z-index:1000; transition: transform 0.25s ease, box-shadow 0.25s ease;}
header:hover { transform: translateY(-2px) scale(1.03); box-shadow: 0 4px 12px rgba(0,0,0,0.15);}
.wrap { padding:16px; padding-top:90px; }
.button-row { display:flex; gap:10px; margin-bottom:12px; position:fixed; top:60px; left:0; right:0; padding:0 16px; background:#f5f7fa; z-index:999; }
.btn { padding:8px 16px; border:none; border-radius:6px; background:#1e5bb8; color:white; cursor:pointer; font-weight:bold; transition: transform 0.2s ease, box-shadow 0.2s ease; }
.btn.active { background:red; }
.btn:hover { transform: translateY(-2px) scale(1.08); box-shadow:0 4px 12px rgba(0,0,0,0.15); }
/* Tombol EL konsisten ukuran & gaya + teks futuristik */
.el-btn {
  position: relative;
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  background: #1e5bb8;
  color: white;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  overflow: hidden;
  z-index: 0;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.el-btn:hover {
  transform: translateY(-2px) scale(1.08);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Animasi glow bergerak */
@keyframes elGlowAnim {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.el-btn::before {
  content: '';
  position: absolute;
  top: -3px; left: -3px; right: -3px; bottom: -3px;
  border-radius: 6px;
  background: linear-gradient(270deg, #0ff, #00f, #0ff, #00f);
  background-size: 400% 400%;
  filter: blur(6px);
  opacity: 0.6;
  z-index: -1;
  transition: opacity 0.3s ease;
  animation: elGlowAnim 3s ease infinite;
}

.el-btn:hover::before {
  opacity: 1;
  filter: blur(10px);
}

.el-btn.active::before {
  opacity: 1;
  filter: blur(8px);
  animation: elGlowAnim 1.5s ease infinite;
}

.week-row { display:flex; gap:8px; margin-bottom:12px; display:none; position:fixed; top:105px; left:0; right:0; padding:0 16px; background:#f5f7fa; z-index:998; }
.week-btn { padding:6px 12px; border:none; border-radius:6px; background:#666; color:white; cursor:pointer; font-weight:bold; transition: transform 0.2s ease, box-shadow 0.2s ease; }
.week-btn.active { background:red; }
.week-btn:hover { transform: translateY(-2px) scale(1.08); box-shadow:0 4px 12px rgba(0,0,0,0.15); }

#dataDisplay { margin-top:150px; overflow-y:auto; max-height:calc(100vh - 150px); padding-bottom:20px; }
.card, .monthly-card { border-radius:8px; padding:6px; transition: transform 0.25s ease, box-shadow 0.25s ease; }
.card:hover, .monthly-card:hover { transform: translateY(-3px) scale(1.03); box-shadow:0 6px 16px rgba(0,0,0,0.18); }
.card.sudah { background:#d4edda; }
.card.belum { background:#f8d7da; }
.monthly-card.sudah { background:#e9d8fd; border:1px solid #d6bcfa; }
.monthly-card.belum { background:#f3e8ff; border:1px solid #e9d5ff; }

.item { border-bottom:1px solid #eee; padding:6px 4px; font-size:13px; position:relative; cursor:default; transition: background 0.12s, padding-left 0.12s; }
.item:hover { background: rgba(0,0,0,0.04); padding-left:4px; }
.item .tooltip{ visibility:hidden; opacity:0; transition:opacity .12s; position:absolute; bottom:125%; left:50%; transform:translateX(-50%); white-space:nowrap; padding:4px 6px; color:#fff; border-radius:4px; font-size:11px; z-index:10; }
.card.sudah .tooltip{ background:#28a745; }
.card.belum .tooltip{ background:#dc3545; }
.monthly-card .tooltip{ color:#0d6efd; background:#e0e0e0; } /* biru text biru, bg abu supaya jelas */
.item:hover .tooltip{ visibility:visible; opacity:1; }

.week-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:12px; }
.chart-wrap { width:400px; height:360px; margin:18px auto; position:relative; text-align:center; background:white; padding:10px; border-radius:8px; }
.chart-wrap canvas{ width:100% !important; height:100% !important; }


/* Loader utama */
#loader {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 30% 30%, #0a0f1f, #000);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #0ff;
  font-family: 'Orbitron', sans-serif;
  z-index: 9999;
  overflow: hidden;
}

/* Judul neon robotik */
#loader h1 {
  font-size: 2.5em;
  margin-bottom: 0.5em;
  font-weight: 700;
  letter-spacing: 2px;
  color: #0ff;
  text-shadow: 0 0 10px #00f0ff, 0 0 20px #00cfff, 0 0 30px #0ff;
  animation: neonFlicker 1.2s infinite;
}

/* Subteks */
#loader p {
  font-size: 1.2em;
  margin-bottom: 2em;
  color: #a2d3ff;
  opacity: 0.8;
  text-shadow: 0 0 6px #00cfff;
}

/* Spinner cyberpunk */
.spinner {
  width: 80px;
  height: 80px;
  border: 6px solid rgba(0, 174, 255, 0.2);
  border-top: 6px solid #00cfff;
  border-right: 6px solid #0088ff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  box-shadow: 0 0 20px #00cfff80;
  margin-bottom: 20px;
}

/* Garis bergerak futuristik */
.scan-line {
  position: absolute;
  width: 180%;
  height: 2px;
  background: linear-gradient(90deg,#00d4ff,#0094ff,#0060ff,#00d4ff);
  opacity: 0.4;
}
.line1 { top: 30%; animation: scan 3s linear infinite; }
.line2 { bottom: 30%; transform: rotate(90deg); animation: scan 3s linear infinite; animation-delay: 1.5s; }

/* Animasi spinner */
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Neon flicker text */
@keyframes neonFlicker {
  0%,19%,21%,23%,25%,54%,56%,100% { opacity:1; text-shadow: 0 0 6px #0ff, 0 0 12px #0ff, 0 0 18px #00d4ff; }
  20%,22%,24%,55% { opacity:0.4; text-shadow: none; }
}

/* Scan line animation */
@keyframes scan {
  0% { transform: translateX(-50%) translateY(-200%); }
  100% { transform: translateX(-50%) translateY(200%); }
}
</style>
</head>
<body>

<header>MONITORING GFORM</header>

<div class="wrap">

<!-- Loader Modern Robotik Cyberpunk -->
<div id="loader">
  <h1>LOADING......PLEASE WAIT....!!</h1>
  <p>Alloh bersama orang-orang sabar</p>
  <div class="spinner"></div>
  <!-- Garis bergerak futuristik -->
  <div class="scan-line line1"></div>
  <div class="scan-line line2"></div>
</div>

  <!-- Buttons -->
  <div class="button-row">
    <button class="btn" id="btnWeekly">Weekly</button>
    <button class="btn" id="btnMonthly">Monthly</button>
    <button class="btn" id="btnExport">Export</button>
    <button class="btn" id="btnRefresh">Refresh</button>
    <button id="btnEL" class="el-btn">EL ⚡</button>
  </div>

  <!-- Weekly week buttons -->
  <div class="week-row" id="weekButtons">
    <button class="week-btn" data-week="1">W1</button>
    <button class="week-btn" data-week="2">W2</button>
    <button class="week-btn" data-week="3">W3</button>
    <button class="week-btn" data-week="4">W4</button>
  </div>

  <!-- Data Display -->
  <div id="dataDisplay"></div>

</div>

<script>

// ------------------
// State
// ------------------
const btnWeekly = document.getElementById("btnWeekly");
const btnMonthly = document.getElementById("btnMonthly");
const btnExport = document.getElementById("btnExport");
const btnRefresh = document.getElementById("btnRefresh");
const weekButtons = document.getElementById("weekButtons");
const weekBtns = document.querySelectorAll(".week-btn");
const dataDisplay = document.getElementById("dataDisplay");
const loader = document.getElementById("loader"); // loader

function resetMainButtons() { [btnWeekly, btnMonthly, btnExport, btnRefresh].forEach(b=>b.classList.remove("active")); }
function resetWeekButtons() { weekBtns.forEach(b=>b.classList.remove("active")); }

// ------------------
// URLs
// ------------------
const MASTER_WEEKLY_CSV = "Data Mesin.csv"; 
const MASTER_MONTHLY_CSV = "Data Mesin Monthly.csv"; 

// WEEKLY
const WEEKLY_SHEET_ID = "19FeEccnYkZVAZo0lO-erbgLtJDAalG3IzwaiLympdck";
const WEEKLY_SHEET_NAME = "Form Responses 1";
const WEEKLY_SHEET_URL = `https://opensheet.elk.sh/${WEEKLY_SHEET_ID}/${encodeURIComponent(WEEKLY_SHEET_NAME)}`;

// MONTHLY — URL BARU
const MONTHLY_FORM_URL = "https://opensheet.elk.sh/134suRLzzkA8d7G_I9k535R-hlA_IpYvV67MgTQ8HlKw/Form%20Responses%201";

// ------------------
// Data
// ------------------
let weeklyRows=[], monthlyRows=[], masterWeekly=[], masterMonthly=[];

// ------------------
// Utils
// ------------------
function safe(v){ return v==null?"":String(v).trim(); }
async function loadCSV(url){ return new Promise(resolve=>{ Papa.parse(url,{download:true,header:true,skipEmptyLines:true,complete:r=>resolve(r.data),error:()=>resolve([])}); }); }

// ------------------
// Load all data
// ------------------
async function loadAll(){
  masterWeekly = await loadCSV(MASTER_WEEKLY_CSV);
  masterMonthly = await loadCSV(MASTER_MONTHLY_CSV);
  weeklyRows = await fetch(WEEKLY_SHEET_URL).then(r=>r.json()).catch(()=>[]);
  monthlyRows = await fetch(MONTHLY_FORM_URL).then(r=>r.json()).catch(()=>[]);
  console.log("Data loaded:", masterWeekly.length,"weekly,", masterMonthly.length,"monthly");
  // <<< Nempel debug di sini
  console.log("Data loaded:");
  console.log("masterWeekly:", masterWeekly.length, masterWeekly);
  console.log("weeklyRows:", weeklyRows.length, weeklyRows);
  console.log("masterMonthly:", masterMonthly.length, masterMonthly);
  console.log("monthlyRows:", monthlyRows.length, monthlyRows);
}

// ------------------
// Render Weekly
// ------------------
function renderWeekly(weekNumber){
    const targetWeek = `Week ${weekNumber}`;
    const list = masterWeekly.filter(m => safe(m.WEEK) === targetWeek);
    const sudahList = [], belumList = [];

    list.forEach(m=>{
        const id = safe(m["ID Mesin"]);
        const match = weeklyRows.find(r => safe(r["ID Mesin"]) === id && safe(r["WEEK"]) === targetWeek);
        if(match) sudahList.push({...m, Timestamp:safe(match.Timestamp)});
        else belumList.push(m);
    });

    function chunkInto(arr,n=4){
        const out = Array.from({length:n},()=>[]);
        let idx=0, base=Math.floor(arr.length/n), rem=arr.length%n;
        for(let i=0;i<n;i++){
            const size = base+(i<rem?1:0);
            out[i]=arr.slice(idx, idx+size);
            idx+=size;
        }
        return out;
    }

    let html=`<h3>Sudah Input (${sudahList.length} mesin)</h3>`;
    const colSud = chunkInto(sudahList);

    html+=`<div class="week-grid">`+
        colSud.map(col=>`
        <div class="card sudah">
            ${col.map(m=>`
            <div class="item">
                <strong>${safe(m["ID Mesin"])}</strong> — ${safe(m.SEKTOR)}<br>
                ${safe(m["Nama Lokasi"])}<br>
                <small>${m.Timestamp}</small>
                <span class="tooltip">Timestamp: ${m.Timestamp}</span>
            </div>`).join('')}
        </div>`).join('')
    +`</div>`;

    html+=`<h3>Belum Input (${belumList.length} mesin)</h3>`;
    const colBel = chunkInto(belumList);

    html+=`<div class="week-grid">`+
        colBel.map(col=>`
        <div class="card belum">
            ${col.map(m=>`
            <div class="item">
                <strong>${safe(m["ID Mesin"])}</strong> — ${safe(m.SEKTOR)}<br>
                ${safe(m["Nama Lokasi"])}
                <span class="tooltip">Belum input</span>
            </div>`).join('')}
        </div>`).join('')
    +`</div>`;

    dataDisplay.innerHTML = html;
}

// ------------------
// Render Monthly
// ------------------
function renderMonthly(){
    const sudah=[], belum=[];
    masterMonthly.forEach(m=>{
        const id = safe(m["ID Mesin"]);
        const nama = safe(m["Nama Lokasi"]) || "—";
        const sektor = safe(m.Sektor || m.SEKTOR) || "—";

        const match = monthlyRows.find(r => safe(r["ID Mesin"]) === id);

        if(match){
            let tsRaw = safe(match.Timestamp);
            let ts = tsRaw;
            const d = new Date(tsRaw);
            if(!isNaN(d)) ts = d.toLocaleString("id-ID",{hour12:false});
            sudah.push({id,nama,sektor,ts});
        } else {
            belum.push({id,nama,sektor});
        }
    });

    function chunk(arr,n=4){
        const out = Array.from({length:n},()=>[]);
        let idx=0; const base=Math.floor(arr.length/n), rem=arr.length%n;
        for(let i=0;i<n;i++){
            const size=base+(i<rem?1:0);
            out[i]=arr.slice(idx,idx+size);
            idx+=size;
        }
        return out;
    }

    let html=`<h3>Sudah Input (${sudah.length} mesin)</h3>`;
    html+=`<div class="week-grid">`+
      chunk(sudah).map(col=>`
        <div class="monthly-card sudah">
          ${col.map(c=>`
            <div class="item">
              <strong>${c.id}</strong> — ${c.sektor}<br>
              ${c.nama}<br>
              <small>${c.ts}</small>
              <span class="tooltip">Timestamp: ${c.ts}</span>
            </div>`).join("")}
        </div>`).join("")
    +`</div>`;

    html+=`<h3>Belum Input (${belum.length} mesin)</h3>`;
    html+=`<div class="week-grid">`+
      chunk(belum).map(col=>`
        <div class="monthly-card belum">
          ${col.map(c=>`
            <div class="item">
              <strong>${c.id}</strong> — ${c.sektor}<br>
              ${c.nama}
              <span class="tooltip">Belum input</span>
            </div>`).join("")}
        </div>`).join("")
    +`</div>`;

    dataDisplay.innerHTML = html;
}

// ------------------
// Button Monthly
// ------------------
btnMonthly.addEventListener("click", async ()=>{
    resetMainButtons();
    btnMonthly.classList.add("active");
    weekButtons.style.display="none";

    dataDisplay.innerHTML = "<div class='card'>Loading monthly data…</div>";

    masterMonthly = await loadCSV(MASTER_MONTHLY_CSV);
    monthlyRows = await fetch(MONTHLY_FORM_URL).then(r=>r.json()).catch(()=>[]);

    renderMonthly();
});

// ------------------
// Button Weekly
// ------------------
btnWeekly.addEventListener("click", async ()=>{
    resetMainButtons();
    btnWeekly.classList.add("active");
    weekButtons.style.display="flex";
    dataDisplay.innerHTML="<div class='card'>Loading weekly data…</div>";

    resetWeekButtons();
    if(masterWeekly.length===0 || weeklyRows.length===0) await loadAll();

    dataDisplay.innerHTML="<div class='card'>Pilih week untuk melihat data</div>";
});

// Week buttons
weekBtns.forEach(b=>{
    b.addEventListener("click", async ()=>{
        resetWeekButtons();
        b.classList.add("active");
        dataDisplay.innerHTML="<div class='card'>Loading week "+b.dataset.week+"…</div>";

        if(masterWeekly.length===0 || weeklyRows.length===0) await loadAll();

        renderWeekly(b.dataset.week);
    });
}); // ← FIX KURUNG DI SINI

// ------------------
// Refresh
// ------------------
btnRefresh.addEventListener("click", async ()=>{
    resetMainButtons();
    btnRefresh.classList.add("active");
    dataDisplay.innerHTML="<div class='card'>Refresh…</div>";
    await loadAll();
    dataDisplay.innerHTML="<div class='card'>Data terbaru sudah dimuat.</div>";
});


// ----- EL Button Logic with Cyberpunk Glitch + Neon Flicker -----
const btnEL = document.getElementById("btnEL");
let elContainer = null;

btnEL.addEventListener("click", ()=>{
    resetMainButtons();
    btnEL.classList.add("active");

    // Disable button lain
    [btnWeekly, btnMonthly, btnExport, btnRefresh].forEach(b=>b.disabled=true);

    dataDisplay.innerHTML = "";
    elContainer = document.createElement("div");
    elContainer.style.textAlign = "center";
    elContainer.style.marginTop = "60px";
    elContainer.style.opacity = 0;
    elContainer.style.transition = "opacity 0.5s ease-in-out";
    dataDisplay.appendChild(elContainer);
    setTimeout(()=>elContainer.style.opacity=1,50);

    // Tombol "Klik"
    const klikBtn = document.createElement("button");
    klikBtn.textContent = "Klik";
    klikBtn.className = "btn";
    klikBtn.style.fontSize = "18px";
    klikBtn.style.padding = "12px 24px";
    klikBtn.style.transition = "transform 0.3s, box-shadow 0.3s";
    klikBtn.onmouseover = ()=>{ klikBtn.style.transform="scale(1.1)"; klikBtn.style.boxShadow="0 6px 18px rgba(0,0,0,0.25)"; };
    klikBtn.onmouseout = ()=>{ klikBtn.style.transform="scale(1)"; klikBtn.style.boxShadow=""; };
    elContainer.appendChild(klikBtn);

    klikBtn.addEventListener("click", ()=>{
        klikBtn.style.transition = "opacity 0.4s";
        klikBtn.style.opacity = 0;

        // Loader cyberpunk glitch
        const loader = document.createElement("div");
        loader.style.width = "70px";
        loader.style.height = "70px";
        loader.style.margin = "40px auto";
        loader.style.position = "relative";
        elContainer.appendChild(loader);

        // Neon rings
        for(let i=0;i<3;i++){
            const ring = document.createElement("div");
            ring.style.position = "absolute";
            ring.style.top="0"; ring.style.left="0"; ring.style.right="0"; ring.style.bottom="0";
            ring.style.border="4px solid #1e5bb8";
            ring.style.borderTop="4px solid #ff00ff";
            ring.style.borderRadius="50%";
            ring.style.animation=`spin ${0.8 + i*0.3}s linear infinite`;
            ring.style.mixBlendMode="screen";
            loader.appendChild(ring);
        }

        // Glitch overlay
        const glitch = document.createElement("div");
        glitch.style.position="absolute";
        glitch.style.top=0; glitch.style.left=0; glitch.style.width="100%"; glitch.style.height="100%";
        glitch.style.background="repeating-linear-gradient(45deg, rgba(255,0,255,0.15), rgba(255,0,255,0.15) 2px, transparent 2px, transparent 4px)";
        glitch.style.animation="glitchAnim 0.2s linear infinite";
        loader.appendChild(glitch);

        // Loader keyframes
        if(!document.getElementById("el-loader-style")){
            const style = document.createElement("style");
            style.id = "el-loader-style";
            style.innerHTML = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                @keyframes glitchAnim {
                    0% { transform: translate(0,0); }
                    20% { transform: translate(-2px,2px); }
                    40% { transform: translate(2px,-1px); }
                    60% { transform: translate(-1px,1px); }
                    80% { transform: translate(1px,-2px); }
                    100% { transform: translate(0,0); }
                }
                @keyframes neonFlicker {
                    0%,19%,21%,23%,25%,54%,56%,100% { opacity:1; text-shadow: 0 0 6px #ff00ff, 0 0 12px #ff00ff; }
                    20%,22%,24%,55% { opacity:0.4; text-shadow: none; }
                }
            `;
            document.head.appendChild(style);
        }

        // Setelah 1,4 detik loader selesai, tampilkan foto + teks + back
        setTimeout(()=>{
            elContainer.innerHTML = "";

            const img = document.createElement("img");
            img.src = "https://drive.google.com/uc?export=view&id=19jwYKbL6ctT7FY8un4_pk3z4MmTkdeCJ";
            img.style.maxWidth = "90%";
            img.style.borderRadius = "12px";
            img.style.marginBottom = "12px";
            img.style.opacity = 0;
            img.style.transition = "opacity 0.7s ease-in-out, transform 0.7s";
            img.style.transform = "scale(0.9)";
            elContainer.appendChild(img);

            const text = document.createElement("div");
            text.textContent = "KEPO MAKSIMAL wkwkwk....";
            text.style.fontSize = "22px";
            text.style.fontWeight = "bold";
            text.style.color = "#ff00ff";
            text.style.marginBottom = "16px";
            text.style.opacity = 0;
            text.style.transition = "opacity 0.7s ease-in-out, transform 0.7s";
            text.style.transform = "translateY(10px)";
            text.style.animation = "neonFlicker 1.2s infinite";
            elContainer.appendChild(text);

            const backBtn = document.createElement("button");
            backBtn.textContent = "Back to Home";
            backBtn.className = "btn";
            backBtn.style.fontSize = "16px";
            backBtn.style.padding = "10px 20px";
            backBtn.style.opacity = 0;
            backBtn.style.transition = "opacity 0.7s ease-in-out, transform 0.7s";
            backBtn.style.transform = "translateY(10px)";
            backBtn.onmouseover = ()=>{ backBtn.style.transform="scale(1.05)"; backBtn.style.boxShadow="0 6px 18px rgba(0,0,0,0.25)"; };
            backBtn.onmouseout = ()=>{ backBtn.style.transform="translateY(10px)"; backBtn.style.boxShadow=""; };
            elContainer.appendChild(backBtn);

            setTimeout(()=>{
                img.style.opacity = 1; img.style.transform="scale(1)";
                text.style.opacity = 1; text.style.transform="translateY(0)";
                backBtn.style.opacity = 1; backBtn.style.transform="translateY(0)";
            },50);

            backBtn.addEventListener("click", ()=>{
                dataDisplay.innerHTML = "<div class='card'>Klik Weekly atau Monthly untuk mulai</div>";
                elContainer = null;
                [btnWeekly, btnMonthly, btnExport, btnRefresh].forEach(b=>b.disabled=false);
                resetMainButtons();
            });
        },1400); // delay total fade-out + loader
    });
});
// ------------------
// Loader Smooth Init
// ------------------
async function initApp() {
    loader.style.opacity = 1;
    loader.style.display = 'flex';
    
    await loadAll(); // load data

    // Fade-out smooth
    loader.style.transition = "opacity 0.6s ease";
    loader.style.opacity = 0;
    setTimeout(()=>loader.style.display = "none", 600);

    // Tampilan awal
    dataDisplay.innerHTML = "<div class='card'>Klik Weekly atau Monthly untuk mulai</div>";
  // ------------------
// Start App
// ------------------
initApp();

</script>
</body>
</html>




















